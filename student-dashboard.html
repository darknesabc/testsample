<script>
    // 로컬스토리지에서 학생 정보 불러오기
    const studentName = localStorage.getItem('studentName');
    const studentSeatNumber = localStorage.getItem('studentSeatNumber');
    const studentGrade = localStorage.getItem('studentGrade'); // 학년 정보 추가
    
    // 학생 이름으로 환영 메시지 표시
    if (studentName) {
        document.getElementById('welcome').innerText = `환영합니다, ${studentName}님!`;
        // 학생 자리번호 및 이름 표시
        document.getElementById('seatNameDisplay').innerText = `자리번호: ${studentSeatNumber}`;
        document.getElementById('nameDisplay').innerText = `이름: ${studentName}`; // 이름 표시
        // 학년 정보 표시
        document.getElementById('gradeDisplay').innerText = `학년: ${studentGrade}`;
    } else {
        window.location.href = 'index.html'; // 로그인 페이지로 리다이렉트
    }

    // 공지사항 데이터를 Google Sheets에서 불러오는 함수
    async function fetchNotices() {
        const sheetId = '199CxKW0EHGTVHMwDIEmNJ5LsOcPxyFUtQv52osl7jTY';
        const apiKey = 'AIzaSyDeS-WjQLmzG7yw1_GWu5Tw3HwFxG5hYbk';
        const studentGrade = localStorage.getItem('studentGrade'); // 학년 정보 가져오기

        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/공지사항?key=${apiKey}`;
        
        try {
            const response = await fetch(url);
            const data = await response.json();
            const rows = data.values;

            // 공지사항 내용을 필터링하여 표시
            const notices = rows.filter(row => row[4] == studentGrade); // F열(4번 인덱스)에 학년 정보가 있다고 가정
            const noticeContent = document.getElementById('notice-content');
            noticeContent.innerHTML = ''; // 이전 내용 지우기
            
            if (notices.length > 0) {
                notices.forEach(notice => {
                    const noticeElement = document.createElement('p');
                    noticeElement.innerText = `공지사항: ${notice[1]} - ${notice[2]} - ${notice[3]}`; // B열(F열)부터 F열까지 표시
                    noticeContent.appendChild(noticeElement);
                });
            } else {
                noticeContent.innerHTML = '<p>해당 학년의 공지사항이 없습니다.</p>';
            }
        } catch (error) {
            console.error('Error fetching data from Google Sheets:', error);
        }
    }

    // 탭 클릭 이벤트 처리
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // 모든 탭에서 active 클래스 제거
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            // 현재 클릭된 탭에 active 클래스 추가
            tab.classList.add('active');

            // 모든 콘텐츠 숨기기
            document.getElementById('notice-content').style.display = 'none';
            document.getElementById('timetable-content').style.display = 'none';
            document.getElementById('grades-content').style.display = 'none';

            // 클릭된 탭에 따라 해당 콘텐츠 표시
            if (tab.id === 'tab-notice') {
                document.getElementById('notice-content').style.display = 'block';
                fetchNotices(); // 공지사항 데이터 가져오기
            } else if (tab.id === 'tab-timetable') {
                document.getElementById('timetable-content').style.display = 'block';
            } else if (tab.id === 'tab-grades') {
                document.getElementById('grades-content').style.display = 'block';
            }
        });
    });

    // 로그아웃 버튼 클릭 시
    document.getElementById('logout-btn').addEventListener('click', function() {
        // 로컬 스토리지에서 모든 정보 제거
        localStorage.clear();
        // 로그인 페이지로 리디렉트
        window.location.href = 'index.html';
    });

    // 드롭다운 메뉴 토글
    document.getElementById('hamburger').addEventListener('click', function() {
        const mobileMenu = document.getElementById('mobile-menu');
        if (mobileMenu.style.display === 'flex') {
            mobileMenu.style.display = 'none';
        } else {
            mobileMenu.style.display = 'flex';
        }
    });
</script>
