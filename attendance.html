<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출결현황</title>
    <style>
        /* 기본 스타일 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        header {
            background-color: #f8f9fa;
            padding: 20px;
            text-align: center;
        }
        h1 {
            margin: 0;
        }
        #content {
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <header>
        <h1>출결현황</h1>
        <input type="date" id="datePicker" />
        <button id="fetch-btn">데이터 가져오기</button>
        <!-- 기존 헤더 내용 -->
    </header>

    <div id="content">
        <div id="attendance-content">
            <table id="attendance-table">
                <thead>
                    <tr>
                        <th>자리번호</th>
                        <th>이름</th>
                        <th>담임</th>
                        <th>학년</th>
                        <th>교시</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="5">출결 정보가 없습니다.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // 로그인한 학생 정보 (예시)
        const studentSeatNumber = '1'; // 자리번호
        const studentName = '홍길동'; // 이름

        // 출결 데이터 가져오기
        function fetchAttendanceData(selectedDate) {
            const sheetId = '199CxKW0EHGTVHMwDIEmNJ5LsOcPxyFUtQv52osl7jTY';
            const sheetName = '출결';
            const apiKey = 'AIzaSyDeS-WjQLmzG7yw1_GWu5Tw3HwFxG5hYbk';

            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values;
                    const attendanceTableBody = document.getElementById('attendance-table').querySelector('tbody');
                    attendanceTableBody.innerHTML = '';

                    if (rows) {
                        const studentData = rows.filter(row => 
                            row[1] === studentName && 
                            row[0] === studentSeatNumber && 
                            row.includes(selectedDate) // 선택한 날짜가 있는지 확인
                        );
                        if (studentData.length > 0) {
                            studentData.forEach(data => {
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${data[0]}</td>
                                    <td>${data[1]}</td>
                                    <td>${data[2]}</td>
                                    <td>${data[3]}</td>
                                    <td>${data[4]}</td>
                                `;
                                attendanceTableBody.appendChild(row);
                            });
                        } else {
                            const row = document.createElement('tr');
                            row.innerHTML = '<td colspan="5">출결 정보가 없습니다.</td>';
                            attendanceTableBody.appendChild(row);
                        }
                    } else {
                        const row = document.createElement('tr');
                        row.innerHTML = '<td colspan="5">출결 정보가 없습니다.</td>';
                        attendanceTableBody.appendChild(row);
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // 버튼 클릭 시 데이터 가져오기
        document.getElementById('fetch-btn').addEventListener('click', () => {
            const selectedDate = document.getElementById('datePicker').value;
            if (selectedDate) {
                fetchAttendanceData(selectedDate);
            } else {
                alert('날짜를 선택해 주세요.');
            }
        });
    </script>
</body>
</html>
