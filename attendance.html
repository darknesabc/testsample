<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¶œê²°í˜„í™©</title>
    <style>
        /* ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ */
    </style>
</head>
<body>
    <header>
        <a href="student-dashboard.html" style="color: #333; font-size: 24px;">ğŸ </a>
        
        <div class="hamburger" id="hamburger">
            <div></div>
            <div></div>
            <div></div>
        </div>

        <nav>
            <a href="attendance.html">ì¶œê²°í˜„í™©</a>
            <a href="Movementlog.html">ì´ë™ì¼ì§€</a>
            <a href="#menu3">ë©”ë‰´3</a>
            <a href="#menu4">ë©”ë‰´4</a>
            <a href="#menu5">ë©”ë‰´5</a>
            <a href="#menu6">ë©”ë‰´6</a>
        </nav>

        <div id="student-info">
            <span id="seatNameDisplay"></span>
            <div class="separator"></div>
            <span id="nameDisplay"></span>
            <div class="separator"></div>
            <span id="gradeDisplay"></span>
            <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </header>

    <h1>ì¶œê²°í˜„í™©</h1>

    <!-- ë‚ ì§œ ì„ íƒê¸° ì¶”ê°€ -->
    <label for="date-picker">ë‚ ì§œ ì„ íƒ: </label>
    <input type="date" id="date-picker" name="date" value="" />

    <div id="attendance-content">
        <table id="attendance-table">
            <thead>
                <tr>
                    <th>ìë¦¬ë²ˆí˜¸</th>
                    <th>ì´ë¦„</th>
                    <th>êµì‹œ</th>
                    <th>ì•ì„  ì—´ ë°ì´í„°</th>
                    <th>ì¶œê²° ìƒíƒœ</th>
                </tr>
            </thead>
            <tbody>
                <!-- ì¶œê²° ë°ì´í„°ê°€ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤. -->
            </tbody>
        </table>
    </div>

    <script>
        const studentName = localStorage.getItem('studentName');
        const studentSeatNumber = localStorage.getItem('studentSeatNumber');
        const studentGrade = localStorage.getItem('studentGrade');

        // ì´ë¦„, ìë¦¬ë²ˆí˜¸, í•™ë…„ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        if (studentName && studentSeatNumber && studentGrade) {
            document.getElementById('seatNameDisplay').innerText = `ìë¦¬ë²ˆí˜¸: ${studentSeatNumber}`;
            document.getElementById('nameDisplay').innerText = `ì´ë¦„: ${studentName}`;
            document.getElementById('gradeDisplay').innerText = `í•™ë…„: ${studentGrade}`;
        } else {
            window.location.href = 'index.html';
        }

        // ë‚ ì§œ ì„ íƒê¸°ì—ì„œ ì„ íƒí•œ ë‚ ì§œ í˜•ì‹ì„ mm-ddë¡œ ë³€í™˜
        document.getElementById('date-picker').addEventListener('change', function(event) {
            const selectedDate = event.target.value; // ì„ íƒí•œ ë‚ ì§œ (yyyy-mm-dd í˜•ì‹)
            const formattedDate = formatDate(selectedDate);
            console.log("ì„ íƒí•œ ë‚ ì§œ:", formattedDate); // mm-dd í˜•ì‹ ì¶œë ¥

            // ì„ íƒëœ ë‚ ì§œì— ë”°ë¼ ì¶œê²° ë°ì´í„° í•„í„°ë§ ì¶”ê°€
            fetchAttendanceData(formattedDate);

            // "ì•ì„  ì—´ ë°ì´í„°"ë¥¼ ìš”ì¼ë¡œ ë³€ê²½
            const previousDay = getPreviousDay(selectedDate);
            updatePreviousDayHeader(previousDay);
        });

        function formatDate(dateString) {
            const date = new Date(dateString);
            const month = String(date.getMonth() + 1).padStart(2, '0'); // ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ 1ì„ ë”í•¨
            const day = String(date.getDate()).padStart(2, '0');
            return `${month}-${day}`; // mm-dd í˜•ì‹
        }

        // ë‚ ì§œì—ì„œ ìš”ì¼ì„ êµ¬í•˜ëŠ” í•¨ìˆ˜ (0 = ì¼ìš”ì¼, 1 = ì›”ìš”ì¼, ..., 6 = í† ìš”ì¼)
        function getPreviousDay(dateString) {
            const date = new Date(dateString);
            date.setDate(date.getDate()); // í•˜ë£¨ë¡œ ì„¤ì •
            const dayOfWeek = date.getDay(); // ìš”ì¼ ìˆ«ì (0~6)

            // ìš”ì¼ ì´ë¦„ ë°°ì—´
            const daysOfWeek = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];

            return daysOfWeek[dayOfWeek]; // ìš”ì¼ ì´ë¦„ ë°˜í™˜
        }

        // "ì•ì„  ì—´ ë°ì´í„°" í—¤ë” ì—…ë°ì´íŠ¸
        function updatePreviousDayHeader(dayName) {
            const tableHeaders = document.querySelectorAll('#attendance-table th');
            if (tableHeaders.length > 3) {
                tableHeaders[3].innerText = dayName; // "ì•ì„  ì—´ ë°ì´í„°"ì˜ í—¤ë”ë¥¼ ìš”ì¼ë¡œ ì„¤ì •
            }
        }

        // ì¶œê²° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ í…Œì´ë¸”ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ (API í˜¸ì¶œ)
        function fetchAttendanceData(date) {
            // ì‹¤ì œë¡œ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì¶œê²° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
            // ì˜ˆì‹œë¡œ fetchë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
            fetch(`https://api.example.com/attendance?date=${date}`)
                .then(response => response.json())
                .then(data => {
                    // APIë¡œë¶€í„° ë°›ì€ ì¶œê²° ë°ì´í„°ë¥¼ í…Œì´ë¸”ì— ë°˜ì˜í•©ë‹ˆë‹¤.
                    const tbody = document.querySelector('#attendance-table tbody');
                    tbody.innerHTML = ''; // ê¸°ì¡´ ë°ì´í„° ì§€ìš°ê¸°

                    data.forEach(entry => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${entry.seat}</td>
                            <td>${entry.name}</td>
                            <td>${entry.period}</td>
                            <td>${entry.attendance === 'ì¶œì„' ? 'ì •ìƒì¶œì„' : entry.attendance}</td>
                            <td class="${entry.attendance === 'ì¶œì„' ? 'present' : 'absent'}">${entry.attendance}</td>
                        `;
                        tbody.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error("ì¶œê²° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    alert("ì¶œê²° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
        }
    </script>
</body>
</html>
