// 출결 데이터 가져오기
async function fetchAttendanceData(selectedDate) {
    const sheetId = '199CxKW0EHGTVHMwDIEmNJ5LsOcPxyFUtQv52osl7jTY';
    const sheetName = '출결';
    const apiKey = 'AIzaSyDeS-WjQLmzG7yw1_GWu5Tw3HwFxG5hYbk';
    const range = '출결!A:S'; // A열부터 S열까지 데이터 가져오기
    
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
    const data = await response.json();
    
    if (data.values && data.values.length > 0) {
        const tableBody = document.querySelector('#attendance-table tbody');
        tableBody.innerHTML = ''; // 테이블 초기화

        data.values.forEach((row, rowIndex) => {
            const seatNumber = row[0]; // 자리번호 (A열)
            const name = row[1]; // 이름 (B열)

            // 자리번호와 이름이 매칭될 경우에만 표시
            if (seatNumber === studentSeatNumber && name === studentName) {
                const tr = document.createElement('tr');
                row.forEach((cell, index) => {
                    const td = document.createElement('td');

                    // 날짜에 해당하는 열 (G, I, K, M, O, Q, S 열 처리)
                    if ([6, 8, 10, 12, 14, 16, 18].includes(index)) {
                        const cellDate = formatDate(row[5]); // 날짜 열 (F열)을 매칭

                        if (cellDate === selectedDate) {
                            if (cell === '1') {
                                td.textContent = '출석';
                                td.classList.add('present'); // 출석일 경우 초록색 배경 추가
                            } else if (cell === '3') {
                                td.textContent = '결석';
                                td.classList.add('absent'); // 결석일 경우 빨간색 배경 추가
                            } else {
                                td.textContent = cell;
                            }
                        }
                    } else {
                        td.textContent = cell;
                    }
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            }
            // 2행도 추가하도록 수정
            else if (rowIndex === 1) { // 2행도 포함
                const tr = document.createElement('tr');
                row.forEach((cell, index) => {
                    const td = document.createElement('td');

                    // 날짜에 해당하는 열 (G, I, K, M, O, Q, S 열 처리)
                    if ([6, 8, 10, 12, 14, 16, 18].includes(index)) {
                        const cellDate = formatDate(row[5]); // 날짜 열 (F열)을 매칭

                        if (cellDate === selectedDate) {
                            if (cell === '1') {
                                td.textContent = '출석';
                                td.classList.add('present'); // 출석일 경우 초록색 배경 추가
                            } else if (cell === '3') {
                                td.textContent = '결석';
                                td.classList.add('absent'); // 결석일 경우 빨간색 배경 추가
                            } else {
                                td.textContent = cell;
                            }
                        }
                    } else {
                        td.textContent = cell;
                    }
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            }
        });
    }
}
