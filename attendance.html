<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>출결현황</title>
    <style>
        /* 기존 스타일 */
        /* ... (생략) ... */
    </style>
</head>
<body>
    <header>
        <!-- 헤더 내용 (변경 없음) -->
    </header>

    <h1>출결현황</h1>

    <!-- 날짜 선택기 추가 -->
    <label for="date-picker">날짜 선택: </label>
    <input type="date" id="date-picker" name="date" value="" />

    <div id="attendance-content">
        <table id="attendance-table">
            <thead>
                <tr>
                    <th>날짜</th>
                    <th>요일</th>
                    <th>출석 상태</th>
                    <!-- 다른 열은 여기에 추가 -->
                </tr>
            </thead>
            <tbody>
                <!-- 출결 데이터가 여기에 추가됩니다. -->
            </tbody>
        </table>
    </div>

    <script>
        const studentName = localStorage.getItem('studentName');
        const studentSeatNumber = localStorage.getItem('studentSeatNumber');
        const studentGrade = localStorage.getItem('studentGrade');

        if (studentName) {
            document.getElementById('seatNameDisplay').innerText = `자리번호: ${studentSeatNumber}`;
            document.getElementById('nameDisplay').innerText = `이름: ${studentName}`;
            document.getElementById('gradeDisplay').innerText = `학년: ${studentGrade}`;
        } else {
            window.location.href = 'index.html';
        }

        // 날짜 선택기에서 선택한 날짜 형식을 mm-dd로 변환
        document.getElementById('date-picker').addEventListener('change', function(event) {
            const selectedDate = event.target.value; // 선택한 날짜 (yyyy-mm-dd 형식)
            const formattedDate = formatDate(selectedDate);
            console.log("선택한 날짜:", formattedDate); // mm-dd 형식 출력

            // 선택된 날짜에 따라 출결 데이터 필터링 추가 가능
            // 예: fetchAttendanceData(formattedDate);
        });

        function formatDate(dateString) {
            const date = new Date(dateString);
            const month = String(date.getMonth() + 1).padStart(2, '0'); // 월은 0부터 시작하므로 1을 더함
            const day = String(date.getDate()).padStart(2, '0');
            return `${month}-${day}`; // mm-dd 형식
        }

        // 요일을 3글자로 반환하는 함수
        function getDayOfWeek(dateString) {
            const days = ["일", "월", "화", "수", "목", "금", "토"];
            const date = new Date(dateString);
            const dayIndex = date.getDay();
            return days[dayIndex]; // 0은 일요일, 1은 월요일, ...
        }

        // 출결 데이터 가져오기
        async function fetchAttendanceData() {
            const sheetId = '199CxKW0EHGTVHMwDIEmNJ5LsOcPxyFUtQv52osl7jTY';
            const sheetName = '출결';
            const apiKey = 'AIzaSyDeS-WjQLmzG7yw1_GWu5Tw3HwFxG5hYbk';
            const range = '출결!A:S'; // A열부터 S열까지 데이터 가져오기

            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`);
            const data = await response.json();

            if (data.values && data.values.length > 0) {
                const tableBody = document.querySelector('#attendance-table tbody');
                data.values.forEach((row, rowIndex) => {
                    const seatNumber = row[0]; // 자리번호 (A열)
                    const name = row[1]; // 이름 (B열)

                    // 자리번호와 이름이 매칭될 경우에만 표시
                    if (seatNumber === studentSeatNumber && name === studentName) {
                        const tr = document.createElement('tr');
                        row.forEach((cell, index) => {
                            const td = document.createElement('td');

                            // 날짜에 해당하는 G, I, K, M, O, Q, S 열 처리 (index: 6, 8, 10, 12, 14, 16, 18)
                            if ([6, 8, 10, 12, 14, 16, 18].includes(index)) {
                                const dateValue = cell; // 날짜 값 (예: 2025-01-01)
                                const formattedDate = formatDate(dateValue); // mm-dd 형식으로 변환
                                const dayOfWeek = getDayOfWeek(dateValue); // 요일을 3글자 형식으로 변환

                                td.textContent = `${formattedDate} (${dayOfWeek})`; // 날짜와 요일 출력
                                tr.appendChild(td);

                                // 출석 상태 처리
                                const attendanceStatus = row[index + 1]; // 해당 날짜의 출석 상태 (예: '1' 또는 '3')
                                const statusTd = document.createElement('td');
                                if (attendanceStatus === '1') {
                                    statusTd.textContent = '출석';
                                    statusTd.classList.add('present'); // 출석일 경우 초록색 배경 추가
                                } else if (attendanceStatus === '3') {
                                    statusTd.textContent = '결석';
                                    statusTd.classList.add('absent'); // 결석일 경우 빨간색 배경 추가
                                } else {
                                    statusTd.textContent = '기타';
                                }
                                tr.appendChild(statusTd);
                            }
                        });
                        tableBody.appendChild(tr);
                    }
                });
            }
        }

        fetchAttendanceData();

        // 햄버거 메뉴 기능 (변경 없음)
        // ...

        // 로그아웃 버튼 클릭 시 (변경 없음)
        // ...
    </script>
</body>
</html>
